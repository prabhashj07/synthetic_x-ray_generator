{"ast":null,"code":"\"use strict\";\n\nvar _defineProperty = require(\"/home/prabhashj07/synthetic_x-ray_generator/node_modules/@babel/runtime/helpers/defineProperty.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.NIFTI1 = void 0;\nconst utilities_1 = require(\"./utilities\");\n/*** Constructor ***/\n/**\n   * The NIFTI1 constructor.\n   * @constructor\n   * @property {boolean} littleEndian\n   * @property {number} dim_info\n   * @property {number[]} dims - image dimensions\n   * @property {number} intent_p1\n   * @property {number} intent_p2\n   * @property {number} intent_p3\n   * @property {number} intent_code\n   * @property {number} datatypeCode\n   * @property {number} numBitsPerVoxel\n   * @property {number} slice_start\n   * @property {number} slice_end\n   * @property {number} slice_code\n   * @property {number[]} pixDims - voxel dimensions\n   * @property {number} vox_offset\n   * @property {number} scl_slope\n   * @property {number} scl_inter\n   * @property {number} xyzt_units\n   * @property {number} cal_max\n   * @property {number} cal_min\n   * @property {number} slice_duration\n   * @property {number} toffset\n   * @property {string} description\n   * @property {string} aux_file\n   * @property {string} intent_name\n   * @property {number} qform_code\n   * @property {number} sform_code\n   * @property {number} quatern_b\n   * @property {number} quatern_c\n   * @property {number} quatern_d\n   * @property {number} quatern_x\n   * @property {number} quatern_y\n   * @property {number} quatern_z\n   * @property {Array.<Array.<number>>} affine\n   * @property {string} magic\n   * @property {boolean} isHDR - if hdr/img format\n   * @property {number[]} extensionFlag\n   * @property {number} extensionSize\n   * @property {number} extensionCode\n   * @property {nifti.NIFTIEXTENSION[]} extensions\n   * @type {Function}\n   */\nclass NIFTI1 {\n  constructor() {\n    _defineProperty(this, \"littleEndian\", false);\n    _defineProperty(this, \"dim_info\", 0);\n    _defineProperty(this, \"dims\", []);\n    _defineProperty(this, \"intent_p1\", 0.0);\n    _defineProperty(this, \"intent_p2\", 0.0);\n    _defineProperty(this, \"intent_p3\", 0.0);\n    _defineProperty(this, \"intent_code\", 0);\n    _defineProperty(this, \"datatypeCode\", 0);\n    _defineProperty(this, \"numBitsPerVoxel\", 0);\n    _defineProperty(this, \"slice_start\", 0);\n    _defineProperty(this, \"slice_end\", 0);\n    _defineProperty(this, \"slice_code\", 0);\n    _defineProperty(this, \"pixDims\", []);\n    _defineProperty(this, \"vox_offset\", 0);\n    _defineProperty(this, \"scl_slope\", 1.0);\n    _defineProperty(this, \"scl_inter\", 0.0);\n    _defineProperty(this, \"xyzt_units\", 0);\n    _defineProperty(this, \"cal_max\", 0.0);\n    _defineProperty(this, \"cal_min\", 0.0);\n    _defineProperty(this, \"slice_duration\", 0.0);\n    _defineProperty(this, \"toffset\", 0.0);\n    _defineProperty(this, \"description\", \"\");\n    _defineProperty(this, \"aux_file\", \"\");\n    _defineProperty(this, \"intent_name\", \"\");\n    _defineProperty(this, \"qform_code\", 0);\n    _defineProperty(this, \"sform_code\", 0);\n    _defineProperty(this, \"quatern_a\", 0.0);\n    _defineProperty(this, \"quatern_b\", 0.0);\n    _defineProperty(this, \"quatern_c\", 0.0);\n    _defineProperty(this, \"quatern_d\", 0.0);\n    _defineProperty(this, \"qoffset_x\", 0.0);\n    _defineProperty(this, \"qoffset_y\", 0.0);\n    _defineProperty(this, \"qoffset_z\", 0.0);\n    _defineProperty(this, \"affine\", [[1, 0, 0, 0], [0, 1, 0, 0], [0, 0, 1, 0], [0, 0, 0, 1]]);\n    _defineProperty(this, \"qfac\", 1);\n    _defineProperty(this, \"quatern_R\", void 0);\n    _defineProperty(this, \"magic\", \"0\");\n    _defineProperty(this, \"isHDR\", false);\n    _defineProperty(this, \"extensionFlag\", [0, 0, 0, 0]);\n    _defineProperty(this, \"extensionSize\", 0);\n    _defineProperty(this, \"extensionCode\", 0);\n    _defineProperty(this, \"extensions\", []);\n    /**\n     * Returns a human-readable string of datatype.\n     * @param {number} code\n     * @returns {string}\n     */\n    _defineProperty(this, \"getDatatypeCodeString\", function (code) {\n      if (code === NIFTI1.TYPE_UINT8) {\n        return \"1-Byte Unsigned Integer\";\n      } else if (code === NIFTI1.TYPE_INT16) {\n        return \"2-Byte Signed Integer\";\n      } else if (code === NIFTI1.TYPE_INT32) {\n        return \"4-Byte Signed Integer\";\n      } else if (code === NIFTI1.TYPE_FLOAT32) {\n        return \"4-Byte Float\";\n      } else if (code === NIFTI1.TYPE_FLOAT64) {\n        return \"8-Byte Float\";\n      } else if (code === NIFTI1.TYPE_RGB24) {\n        return \"RGB\";\n      } else if (code === NIFTI1.TYPE_INT8) {\n        return \"1-Byte Signed Integer\";\n      } else if (code === NIFTI1.TYPE_UINT16) {\n        return \"2-Byte Unsigned Integer\";\n      } else if (code === NIFTI1.TYPE_UINT32) {\n        return \"4-Byte Unsigned Integer\";\n      } else if (code === NIFTI1.TYPE_INT64) {\n        return \"8-Byte Signed Integer\";\n      } else if (code === NIFTI1.TYPE_UINT64) {\n        return \"8-Byte Unsigned Integer\";\n      } else {\n        return \"Unknown\";\n      }\n    });\n    /**\n     * Returns a human-readable string of transform type.\n     * @param {number} code\n     * @returns {string}\n     */\n    _defineProperty(this, \"getTransformCodeString\", function (code) {\n      if (code === NIFTI1.XFORM_SCANNER_ANAT) {\n        return \"Scanner\";\n      } else if (code === NIFTI1.XFORM_ALIGNED_ANAT) {\n        return \"Aligned\";\n      } else if (code === NIFTI1.XFORM_TALAIRACH) {\n        return \"Talairach\";\n      } else if (code === NIFTI1.XFORM_MNI_152) {\n        return \"MNI\";\n      } else {\n        return \"Unknown\";\n      }\n    });\n    /**\n     * Returns a human-readable string of spatial and temporal units.\n     * @param {number} code\n     * @returns {string}\n     */\n    _defineProperty(this, \"getUnitsCodeString\", function (code) {\n      if (code === NIFTI1.UNITS_METER) {\n        return \"Meters\";\n      } else if (code === NIFTI1.UNITS_MM) {\n        return \"Millimeters\";\n      } else if (code === NIFTI1.UNITS_MICRON) {\n        return \"Microns\";\n      } else if (code === NIFTI1.UNITS_SEC) {\n        return \"Seconds\";\n      } else if (code === NIFTI1.UNITS_MSEC) {\n        return \"Milliseconds\";\n      } else if (code === NIFTI1.UNITS_USEC) {\n        return \"Microseconds\";\n      } else if (code === NIFTI1.UNITS_HZ) {\n        return \"Hz\";\n      } else if (code === NIFTI1.UNITS_PPM) {\n        return \"PPM\";\n      } else if (code === NIFTI1.UNITS_RADS) {\n        return \"Rads\";\n      } else {\n        return \"Unknown\";\n      }\n    });\n    _defineProperty(this, \"nifti_mat33_mul\", function (A, B) {\n      var C = [[0, 0, 0], [0, 0, 0], [0, 0, 0]],\n        i,\n        j;\n      for (i = 0; i < 3; i += 1) {\n        for (j = 0; j < 3; j += 1) {\n          C[i][j] = A[i][0] * B[0][j] + A[i][1] * B[1][j] + A[i][2] * B[2][j];\n        }\n      }\n      return C;\n    });\n    _defineProperty(this, \"nifti_mat33_determ\", function (R) {\n      var r11, r12, r13, r21, r22, r23, r31, r32, r33;\n      /*  INPUT MATRIX:  */\n      r11 = R[0][0];\n      r12 = R[0][1];\n      r13 = R[0][2];\n      r21 = R[1][0];\n      r22 = R[1][1];\n      r23 = R[1][2];\n      r31 = R[2][0];\n      r32 = R[2][1];\n      r33 = R[2][2];\n      return r11 * r22 * r33 - r11 * r32 * r23 - r21 * r12 * r33 + r21 * r32 * r13 + r31 * r12 * r23 - r31 * r22 * r13;\n    });\n  }\n  /*** Prototype Methods ***/\n  /**\n   * Reads the header data.\n   * @param {ArrayBuffer} data\n   */\n  readHeader(data) {\n    var rawData = new DataView(data),\n      magicCookieVal = utilities_1.Utils.getIntAt(rawData, 0, this.littleEndian),\n      ctr,\n      ctrOut,\n      ctrIn,\n      index;\n    if (magicCookieVal !== NIFTI1.MAGIC_COOKIE) {\n      // try as little endian\n      this.littleEndian = true;\n      magicCookieVal = utilities_1.Utils.getIntAt(rawData, 0, this.littleEndian);\n    }\n    if (magicCookieVal !== NIFTI1.MAGIC_COOKIE) {\n      throw new Error(\"This does not appear to be a NIFTI file!\");\n    }\n    this.dim_info = utilities_1.Utils.getByteAt(rawData, 39);\n    for (ctr = 0; ctr < 8; ctr += 1) {\n      index = 40 + ctr * 2;\n      this.dims[ctr] = utilities_1.Utils.getShortAt(rawData, index, this.littleEndian);\n    }\n    this.intent_p1 = utilities_1.Utils.getFloatAt(rawData, 56, this.littleEndian);\n    this.intent_p2 = utilities_1.Utils.getFloatAt(rawData, 60, this.littleEndian);\n    this.intent_p3 = utilities_1.Utils.getFloatAt(rawData, 64, this.littleEndian);\n    this.intent_code = utilities_1.Utils.getShortAt(rawData, 68, this.littleEndian);\n    this.datatypeCode = utilities_1.Utils.getShortAt(rawData, 70, this.littleEndian);\n    this.numBitsPerVoxel = utilities_1.Utils.getShortAt(rawData, 72, this.littleEndian);\n    this.slice_start = utilities_1.Utils.getShortAt(rawData, 74, this.littleEndian);\n    for (ctr = 0; ctr < 8; ctr += 1) {\n      index = 76 + ctr * 4;\n      this.pixDims[ctr] = utilities_1.Utils.getFloatAt(rawData, index, this.littleEndian);\n    }\n    this.vox_offset = utilities_1.Utils.getFloatAt(rawData, 108, this.littleEndian);\n    this.scl_slope = utilities_1.Utils.getFloatAt(rawData, 112, this.littleEndian);\n    this.scl_inter = utilities_1.Utils.getFloatAt(rawData, 116, this.littleEndian);\n    this.slice_end = utilities_1.Utils.getShortAt(rawData, 120, this.littleEndian);\n    this.slice_code = utilities_1.Utils.getByteAt(rawData, 122);\n    this.xyzt_units = utilities_1.Utils.getByteAt(rawData, 123);\n    this.cal_max = utilities_1.Utils.getFloatAt(rawData, 124, this.littleEndian);\n    this.cal_min = utilities_1.Utils.getFloatAt(rawData, 128, this.littleEndian);\n    this.slice_duration = utilities_1.Utils.getFloatAt(rawData, 132, this.littleEndian);\n    this.toffset = utilities_1.Utils.getFloatAt(rawData, 136, this.littleEndian);\n    this.description = utilities_1.Utils.getStringAt(rawData, 148, 228);\n    this.aux_file = utilities_1.Utils.getStringAt(rawData, 228, 252);\n    this.qform_code = utilities_1.Utils.getShortAt(rawData, 252, this.littleEndian);\n    this.sform_code = utilities_1.Utils.getShortAt(rawData, 254, this.littleEndian);\n    this.quatern_b = utilities_1.Utils.getFloatAt(rawData, 256, this.littleEndian);\n    this.quatern_c = utilities_1.Utils.getFloatAt(rawData, 260, this.littleEndian);\n    this.quatern_d = utilities_1.Utils.getFloatAt(rawData, 264, this.littleEndian);\n    // Added by znshje on 27/11/2021\n    //\n    // quatern_a is a parameter in quaternion [a, b, c, d], which is required in affine calculation (METHOD 2)\n    // mentioned in the nifti1.h file\n    // It can be calculated by a = sqrt(1.0-(b*b+c*c+d*d))\n    this.quatern_a = Math.sqrt(1.0 - (Math.pow(this.quatern_b, 2) + Math.pow(this.quatern_c, 2) + Math.pow(this.quatern_d, 2)));\n    this.qoffset_x = utilities_1.Utils.getFloatAt(rawData, 268, this.littleEndian);\n    this.qoffset_y = utilities_1.Utils.getFloatAt(rawData, 272, this.littleEndian);\n    this.qoffset_z = utilities_1.Utils.getFloatAt(rawData, 276, this.littleEndian);\n    // Added by znshje on 27/11/2021\n    //\n    /* See: https://nifti.nimh.nih.gov/pub/dist/src/niftilib/nifti1.h */\n    if (this.qform_code < 1 && this.sform_code < 1) {\n      // METHOD 0 (used when both SFORM and QFORM are unknown)\n      this.affine[0][0] = this.pixDims[1];\n      this.affine[1][1] = this.pixDims[2];\n      this.affine[2][2] = this.pixDims[3];\n    }\n    if (this.qform_code > 0 && this.sform_code < this.qform_code) {\n      //   METHOD 2 (used when qform_code > 0, which should be the \"normal\" case):\n      //    ---------------------------------------------------------------------\n      //    The (x,y,z) coordinates are given by the pixdim[] scales, a rotation\n      //    matrix, and a shift.  This method is intended to represent\n      //    \"scanner-anatomical\" coordinates, which are often embedded in the\n      //    image header (e.g., DICOM fields (0020,0032), (0020,0037), (0028,0030),\n      //    and (0018,0050)), and represent the nominal orientation and location of\n      //    the data.  This method can also be used to represent \"aligned\"\n      //    coordinates, which would typically result from some post-acquisition\n      //    alignment of the volume to a standard orientation (e.g., the same\n      //    subject on another day, or a rigid rotation to true anatomical\n      //    orientation from the tilted position of the subject in the scanner).\n      //    The formula for (x,y,z) in terms of header parameters and (i,j,k) is:\n      //\n      //      [ x ]   [ R11 R12 R13 ] [        pixdim[1] * i ]   [ qoffset_x ]\n      //      [ y ] = [ R21 R22 R23 ] [        pixdim[2] * j ] + [ qoffset_y ]\n      //      [ z ]   [ R31 R32 R33 ] [ qfac * pixdim[3] * k ]   [ qoffset_z ]\n      //\n      //    The qoffset_* shifts are in the NIFTI-1 header.  Note that the center\n      //    of the (i,j,k)=(0,0,0) voxel (first value in the dataset array) is\n      //    just (x,y,z)=(qoffset_x,qoffset_y,qoffset_z).\n      //\n      //    The rotation matrix R is calculated from the quatern_* parameters.\n      //    This calculation is described below.\n      //\n      //    The scaling factor qfac is either 1 or -1.  The rotation matrix R\n      //    defined by the quaternion parameters is \"proper\" (has determinant 1).\n      //    This may not fit the needs of the data; for example, if the image\n      //    grid is\n      //      i increases from Left-to-Right\n      //      j increases from Anterior-to-Posterior\n      //      k increases from Inferior-to-Superior\n      //    Then (i,j,k) is a left-handed triple.  In this example, if qfac=1,\n      //    the R matrix would have to be\n      //\n      //      [  1   0   0 ]\n      //      [  0  -1   0 ]  which is \"improper\" (determinant = -1).\n      //      [  0   0   1 ]\n      //\n      //    If we set qfac=-1, then the R matrix would be\n      //\n      //      [  1   0   0 ]\n      //      [  0  -1   0 ]  which is proper.\n      //      [  0   0  -1 ]\n      //\n      //    This R matrix is represented by quaternion [a,b,c,d] = [0,1,0,0]\n      //    (which encodes a 180 degree rotation about the x-axis).\n      // Define a, b, c, d for coding covenience\n      const a = this.quatern_a;\n      const b = this.quatern_b;\n      const c = this.quatern_c;\n      const d = this.quatern_d;\n      this.qfac = this.pixDims[0] === 0 ? 1 : this.pixDims[0];\n      this.quatern_R = [[a * a + b * b - c * c - d * d, 2 * b * c - 2 * a * d, 2 * b * d + 2 * a * c], [2 * b * c + 2 * a * d, a * a + c * c - b * b - d * d, 2 * c * d - 2 * a * b], [2 * b * d - 2 * a * c, 2 * c * d + 2 * a * b, a * a + d * d - c * c - b * b]];\n      for (ctrOut = 0; ctrOut < 3; ctrOut += 1) {\n        for (ctrIn = 0; ctrIn < 3; ctrIn += 1) {\n          this.affine[ctrOut][ctrIn] = this.quatern_R[ctrOut][ctrIn] * this.pixDims[ctrIn + 1];\n          if (ctrIn === 2) {\n            this.affine[ctrOut][ctrIn] *= this.qfac;\n          }\n        }\n      }\n      // The last row of affine matrix is the offset vector\n      this.affine[0][3] = this.qoffset_x;\n      this.affine[1][3] = this.qoffset_y;\n      this.affine[2][3] = this.qoffset_z;\n    } else if (this.sform_code > 0) {\n      //    METHOD 3 (used when sform_code > 0):\n      //    -----------------------------------\n      //    The (x,y,z) coordinates are given by a general affine transformation\n      //    of the (i,j,k) indexes:\n      //\n      //      x = srow_x[0] * i + srow_x[1] * j + srow_x[2] * k + srow_x[3]\n      //      y = srow_y[0] * i + srow_y[1] * j + srow_y[2] * k + srow_y[3]\n      //      z = srow_z[0] * i + srow_z[1] * j + srow_z[2] * k + srow_z[3]\n      //\n      //    The srow_* vectors are in the NIFTI_1 header.  Note that no use is\n      //    made of pixdim[] in this method.\n      for (ctrOut = 0; ctrOut < 3; ctrOut += 1) {\n        for (ctrIn = 0; ctrIn < 4; ctrIn += 1) {\n          index = 280 + (ctrOut * 4 + ctrIn) * 4;\n          this.affine[ctrOut][ctrIn] = utilities_1.Utils.getFloatAt(rawData, index, this.littleEndian);\n        }\n      }\n    }\n    this.affine[3][0] = 0;\n    this.affine[3][1] = 0;\n    this.affine[3][2] = 0;\n    this.affine[3][3] = 1;\n    this.intent_name = utilities_1.Utils.getStringAt(rawData, 328, 344);\n    this.magic = utilities_1.Utils.getStringAt(rawData, 344, 348);\n    this.isHDR = this.magic === String.fromCharCode.apply(null, NIFTI1.MAGIC_NUMBER2);\n    if (rawData.byteLength > NIFTI1.MAGIC_COOKIE) {\n      this.extensionFlag[0] = utilities_1.Utils.getByteAt(rawData, 348);\n      this.extensionFlag[1] = utilities_1.Utils.getByteAt(rawData, 348 + 1);\n      this.extensionFlag[2] = utilities_1.Utils.getByteAt(rawData, 348 + 2);\n      this.extensionFlag[3] = utilities_1.Utils.getByteAt(rawData, 348 + 3);\n      let isExtensionCapable = true;\n      if (!this.isHDR && this.vox_offset <= 352) isExtensionCapable = false;\n      if (rawData.byteLength <= 352 + 16) isExtensionCapable = false;\n      if (isExtensionCapable && this.extensionFlag[0]) {\n        // read our extensions\n        this.extensions = utilities_1.Utils.getExtensionsAt(rawData, this.getExtensionLocation(), this.littleEndian, this.vox_offset);\n        // set the extensionSize and extensionCode from the first extension found\n        this.extensionSize = this.extensions[0].esize;\n        this.extensionCode = this.extensions[0].ecode;\n      }\n    }\n  }\n  /**\n   * Returns a formatted string of header fields.\n   * @returns {string}\n   */\n  toFormattedString() {\n    var fmt = utilities_1.Utils.formatNumber,\n      string = \"\";\n    string += \"Dim Info = \" + this.dim_info + \"\\n\";\n    string += \"Image Dimensions (1-8): \" + this.dims[0] + \", \" + this.dims[1] + \", \" + this.dims[2] + \", \" + this.dims[3] + \", \" + this.dims[4] + \", \" + this.dims[5] + \", \" + this.dims[6] + \", \" + this.dims[7] + \"\\n\";\n    string += \"Intent Parameters (1-3): \" + this.intent_p1 + \", \" + this.intent_p2 + \", \" + this.intent_p3 + \"\\n\";\n    string += \"Intent Code = \" + this.intent_code + \"\\n\";\n    string += \"Datatype = \" + this.datatypeCode + \" (\" + this.getDatatypeCodeString(this.datatypeCode) + \")\\n\";\n    string += \"Bits Per Voxel = \" + this.numBitsPerVoxel + \"\\n\";\n    string += \"Slice Start = \" + this.slice_start + \"\\n\";\n    string += \"Voxel Dimensions (1-8): \" + fmt(this.pixDims[0]) + \", \" + fmt(this.pixDims[1]) + \", \" + fmt(this.pixDims[2]) + \", \" + fmt(this.pixDims[3]) + \", \" + fmt(this.pixDims[4]) + \", \" + fmt(this.pixDims[5]) + \", \" + fmt(this.pixDims[6]) + \", \" + fmt(this.pixDims[7]) + \"\\n\";\n    string += \"Image Offset = \" + this.vox_offset + \"\\n\";\n    string += \"Data Scale:  Slope = \" + fmt(this.scl_slope) + \"  Intercept = \" + fmt(this.scl_inter) + \"\\n\";\n    string += \"Slice End = \" + this.slice_end + \"\\n\";\n    string += \"Slice Code = \" + this.slice_code + \"\\n\";\n    string += \"Units Code = \" + this.xyzt_units + \" (\" + this.getUnitsCodeString(NIFTI1.SPATIAL_UNITS_MASK & this.xyzt_units) + \", \" + this.getUnitsCodeString(NIFTI1.TEMPORAL_UNITS_MASK & this.xyzt_units) + \")\\n\";\n    string += \"Display Range:  Max = \" + fmt(this.cal_max) + \"  Min = \" + fmt(this.cal_min) + \"\\n\";\n    string += \"Slice Duration = \" + this.slice_duration + \"\\n\";\n    string += \"Time Axis Shift = \" + this.toffset + \"\\n\";\n    string += 'Description: \"' + this.description + '\"\\n';\n    string += 'Auxiliary File: \"' + this.aux_file + '\"\\n';\n    string += \"Q-Form Code = \" + this.qform_code + \" (\" + this.getTransformCodeString(this.qform_code) + \")\\n\";\n    string += \"S-Form Code = \" + this.sform_code + \" (\" + this.getTransformCodeString(this.sform_code) + \")\\n\";\n    string += \"Quaternion Parameters:  \" + \"b = \" + fmt(this.quatern_b) + \"  \" + \"c = \" + fmt(this.quatern_c) + \"  \" + \"d = \" + fmt(this.quatern_d) + \"\\n\";\n    string += \"Quaternion Offsets:  \" + \"x = \" + this.qoffset_x + \"  \" + \"y = \" + this.qoffset_y + \"  \" + \"z = \" + this.qoffset_z + \"\\n\";\n    string += \"S-Form Parameters X: \" + fmt(this.affine[0][0]) + \", \" + fmt(this.affine[0][1]) + \", \" + fmt(this.affine[0][2]) + \", \" + fmt(this.affine[0][3]) + \"\\n\";\n    string += \"S-Form Parameters Y: \" + fmt(this.affine[1][0]) + \", \" + fmt(this.affine[1][1]) + \", \" + fmt(this.affine[1][2]) + \", \" + fmt(this.affine[1][3]) + \"\\n\";\n    string += \"S-Form Parameters Z: \" + fmt(this.affine[2][0]) + \", \" + fmt(this.affine[2][1]) + \", \" + fmt(this.affine[2][2]) + \", \" + fmt(this.affine[2][3]) + \"\\n\";\n    string += 'Intent Name: \"' + this.intent_name + '\"\\n';\n    if (this.extensionFlag[0]) {\n      string += \"Extension: Size = \" + this.extensionSize + \"  Code = \" + this.extensionCode + \"\\n\";\n    }\n    return string;\n  }\n  /**\n   * Returns the qform matrix.\n   * @returns {Array.<Array.<number>>}\n   */\n  getQformMat() {\n    return this.convertNiftiQFormToNiftiSForm(this.quatern_b, this.quatern_c, this.quatern_d, this.qoffset_x, this.qoffset_y, this.qoffset_z, this.pixDims[1], this.pixDims[2], this.pixDims[3], this.pixDims[0]);\n  }\n  /**\n   * Converts qform to an affine.  (See http://nifti.nimh.nih.gov/pub/dist/src/niftilib/nifti1_io.c)\n   * @param {number} qb\n   * @param {number} qc\n   * @param {number} qd\n   * @param {number} qx\n   * @param {number} qy\n   * @param {number} qz\n   * @param {number} dx\n   * @param {number} dy\n   * @param {number} dz\n   * @param {number} qfac\n   * @returns {Array.<Array.<number>>}\n   */\n  convertNiftiQFormToNiftiSForm(qb, qc, qd, qx, qy, qz, dx, dy, dz, qfac) {\n    var R = [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]],\n      a,\n      b = qb,\n      c = qc,\n      d = qd,\n      xd,\n      yd,\n      zd;\n    // last row is always [ 0 0 0 1 ]\n    R[3][0] = R[3][1] = R[3][2] = 0.0;\n    R[3][3] = 1.0;\n    // compute a parameter from b,c,d\n    a = 1.0 - (b * b + c * c + d * d);\n    if (a < 0.0000001) {\n      /* special case */\n      a = 1.0 / Math.sqrt(b * b + c * c + d * d);\n      b *= a;\n      c *= a;\n      d *= a; /* normalize (b,c,d) vector */\n      a = 0.0; /* a = 0 ==> 180 degree rotation */\n    } else {\n      a = Math.sqrt(a); /* angle = 2*arccos(a) */\n    }\n    // load rotation matrix, including scaling factors for voxel sizes\n    xd = dx > 0.0 ? dx : 1.0; /* make sure are positive */\n    yd = dy > 0.0 ? dy : 1.0;\n    zd = dz > 0.0 ? dz : 1.0;\n    if (qfac < 0.0) {\n      zd = -zd; /* left handedness? */\n    }\n    R[0][0] = (a * a + b * b - c * c - d * d) * xd;\n    R[0][1] = 2.0 * (b * c - a * d) * yd;\n    R[0][2] = 2.0 * (b * d + a * c) * zd;\n    R[1][0] = 2.0 * (b * c + a * d) * xd;\n    R[1][1] = (a * a + c * c - b * b - d * d) * yd;\n    R[1][2] = 2.0 * (c * d - a * b) * zd;\n    R[2][0] = 2.0 * (b * d - a * c) * xd;\n    R[2][1] = 2.0 * (c * d + a * b) * yd;\n    R[2][2] = (a * a + d * d - c * c - b * b) * zd;\n    // load offsets\n    R[0][3] = qx;\n    R[1][3] = qy;\n    R[2][3] = qz;\n    return R;\n  }\n  /**\n   * Converts sform to an orientation string (e.g., XYZ+--).  (See http://nifti.nimh.nih.gov/pub/dist/src/niftilib/nifti1_io.c)\n   * @param {Array.<Array.<number>>} R\n   * @returns {string}\n   */\n  convertNiftiSFormToNEMA(R) {\n    var xi, xj, xk, yi, yj, yk, zi, zj, zk, val, detQ, detP, i, j, k, p, q, r, ibest, jbest, kbest, pbest, qbest, rbest, M, vbest, Q, P, iChar, jChar, kChar, iSense, jSense, kSense;\n    k = 0;\n    Q = [[0, 0, 0], [0, 0, 0], [0, 0, 0]];\n    P = [[0, 0, 0], [0, 0, 0], [0, 0, 0]];\n    //if( icod == NULL || jcod == NULL || kcod == NULL ) return ; /* bad */\n    //*icod = *jcod = *kcod = 0 ; /* this.errorMessage returns, if sh*t happens */\n    /* load column vectors for each (i,j,k) direction from matrix */\n    /*-- i axis --*/ /*-- j axis --*/ /*-- k axis --*/\n    xi = R[0][0];\n    xj = R[0][1];\n    xk = R[0][2];\n    yi = R[1][0];\n    yj = R[1][1];\n    yk = R[1][2];\n    zi = R[2][0];\n    zj = R[2][1];\n    zk = R[2][2];\n    /* normalize column vectors to get unit vectors along each ijk-axis */\n    /* normalize i axis */\n    val = Math.sqrt(xi * xi + yi * yi + zi * zi);\n    if (val === 0.0) {\n      /* stupid input */\n      return null;\n    }\n    xi /= val;\n    yi /= val;\n    zi /= val;\n    /* normalize j axis */\n    val = Math.sqrt(xj * xj + yj * yj + zj * zj);\n    if (val === 0.0) {\n      /* stupid input */\n      return null;\n    }\n    xj /= val;\n    yj /= val;\n    zj /= val;\n    /* orthogonalize j axis to i axis, if needed */\n    val = xi * xj + yi * yj + zi * zj; /* dot product between i and j */\n    if (Math.abs(val) > 1e-4) {\n      xj -= val * xi;\n      yj -= val * yi;\n      zj -= val * zi;\n      val = Math.sqrt(xj * xj + yj * yj + zj * zj); /* must renormalize */\n      if (val === 0.0) {\n        /* j was parallel to i? */\n        return null;\n      }\n      xj /= val;\n      yj /= val;\n      zj /= val;\n    }\n    /* normalize k axis; if it is zero, make it the cross product i x j */\n    val = Math.sqrt(xk * xk + yk * yk + zk * zk);\n    if (val === 0.0) {\n      xk = yi * zj - zi * yj;\n      yk = zi * xj - zj * xi;\n      zk = xi * yj - yi * xj;\n    } else {\n      xk /= val;\n      yk /= val;\n      zk /= val;\n    }\n    /* orthogonalize k to i */\n    val = xi * xk + yi * yk + zi * zk; /* dot product between i and k */\n    if (Math.abs(val) > 1e-4) {\n      xk -= val * xi;\n      yk -= val * yi;\n      zk -= val * zi;\n      val = Math.sqrt(xk * xk + yk * yk + zk * zk);\n      if (val === 0.0) {\n        /* bad */\n        return null;\n      }\n      xk /= val;\n      yk /= val;\n      zk /= val;\n    }\n    /* orthogonalize k to j */\n    val = xj * xk + yj * yk + zj * zk; /* dot product between j and k */\n    if (Math.abs(val) > 1e-4) {\n      xk -= val * xj;\n      yk -= val * yj;\n      zk -= val * zj;\n      val = Math.sqrt(xk * xk + yk * yk + zk * zk);\n      if (val === 0.0) {\n        /* bad */\n        return null;\n      }\n      xk /= val;\n      yk /= val;\n      zk /= val;\n    }\n    Q[0][0] = xi;\n    Q[0][1] = xj;\n    Q[0][2] = xk;\n    Q[1][0] = yi;\n    Q[1][1] = yj;\n    Q[1][2] = yk;\n    Q[2][0] = zi;\n    Q[2][1] = zj;\n    Q[2][2] = zk;\n    /* at this point, Q is the rotation matrix from the (i,j,k) to (x,y,z) axes */\n    detQ = this.nifti_mat33_determ(Q);\n    if (detQ === 0.0) {\n      /* shouldn't happen unless user is a DUFIS */\n      return null;\n    }\n    /* Build and test all possible +1/-1 coordinate permutation matrices P;\n    then find the P such that the rotation matrix M=PQ is closest to the\n    identity, in the sense of M having the smallest total rotation angle. */\n    /* Despite the formidable looking 6 nested loops, there are\n    only 3*3*3*2*2*2 = 216 passes, which will run very quickly. */\n    vbest = -666.0;\n    ibest = pbest = qbest = rbest = 1;\n    jbest = 2;\n    kbest = 3;\n    for (i = 1; i <= 3; i += 1) {\n      /* i = column number to use for row #1 */\n      for (j = 1; j <= 3; j += 1) {\n        /* j = column number to use for row #2 */\n        if (i !== j) {\n          for (k = 1; k <= 3; k += 1) {\n            /* k = column number to use for row #3 */\n            if (!(i === k || j === k)) {\n              P[0][0] = P[0][1] = P[0][2] = P[1][0] = P[1][1] = P[1][2] = P[2][0] = P[2][1] = P[2][2] = 0.0;\n              for (p = -1; p <= 1; p += 2) {\n                /* p,q,r are -1 or +1      */\n                for (q = -1; q <= 1; q += 2) {\n                  /* and go into rows #1,2,3 */\n                  for (r = -1; r <= 1; r += 2) {\n                    P[0][i - 1] = p;\n                    P[1][j - 1] = q;\n                    P[2][k - 1] = r;\n                    detP = this.nifti_mat33_determ(P); /* sign of permutation */\n                    if (detP * detQ > 0.0) {\n                      M = this.nifti_mat33_mul(P, Q);\n                      /* angle of M rotation = 2.0*acos(0.5*sqrt(1.0+trace(M)))       */\n                      /* we want largest trace(M) == smallest angle == M nearest to I */\n                      val = M[0][0] + M[1][1] + M[2][2]; /* trace */\n                      if (val > vbest) {\n                        vbest = val;\n                        ibest = i;\n                        jbest = j;\n                        kbest = k;\n                        pbest = p;\n                        qbest = q;\n                        rbest = r;\n                      }\n                    } /* doesn't match sign of Q */\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n    /* At this point ibest is 1 or 2 or 3; pbest is -1 or +1; etc.\n      The matrix P that corresponds is the best permutation approximation\n    to Q-inverse; that is, P (approximately) takes (x,y,z) coordinates\n    to the (i,j,k) axes.\n      For example, the first row of P (which contains pbest in column ibest)\n    determines the way the i axis points relative to the anatomical\n    (x,y,z) axes.  If ibest is 2, then the i axis is along the y axis,\n    which is direction P2A (if pbest > 0) or A2P (if pbest < 0).\n      So, using ibest and pbest, we can assign the output code for\n    the i axis.  Mutatis mutandis for the j and k axes, of course. */\n    iChar = jChar = kChar = iSense = jSense = kSense = \"\";\n    switch (ibest * pbest) {\n      case 1 /*i = NIFTI_L2R*/:\n        iChar = \"X\";\n        iSense = \"+\";\n        break;\n      case -1 /*i = NIFTI_R2L*/:\n        iChar = \"X\";\n        iSense = \"-\";\n        break;\n      case 2 /*i = NIFTI_P2A*/:\n        iChar = \"Y\";\n        iSense = \"+\";\n        break;\n      case -2 /*i = NIFTI_A2P*/:\n        iChar = \"Y\";\n        iSense = \"-\";\n        break;\n      case 3 /*i = NIFTI_I2S*/:\n        iChar = \"Z\";\n        iSense = \"+\";\n        break;\n      case -3 /*i = NIFTI_S2I*/:\n        iChar = \"Z\";\n        iSense = \"-\";\n        break;\n    }\n    switch (jbest * qbest) {\n      case 1 /*j = NIFTI_L2R*/:\n        jChar = \"X\";\n        jSense = \"+\";\n        break;\n      case -1 /*j = NIFTI_R2L*/:\n        jChar = \"X\";\n        jSense = \"-\";\n        break;\n      case 2 /*j = NIFTI_P2A*/:\n        jChar = \"Y\";\n        jSense = \"+\";\n        break;\n      case -2 /*j = NIFTI_A2P*/:\n        jChar = \"Y\";\n        jSense = \"-\";\n        break;\n      case 3 /*j = NIFTI_I2S*/:\n        jChar = \"Z\";\n        jSense = \"+\";\n        break;\n      case -3 /*j = NIFTI_S2I*/:\n        jChar = \"Z\";\n        jSense = \"-\";\n        break;\n    }\n    switch (kbest * rbest) {\n      case 1 /*k = NIFTI_L2R*/:\n        kChar = \"X\";\n        kSense = \"+\";\n        break;\n      case -1 /*k = NIFTI_R2L*/:\n        kChar = \"X\";\n        kSense = \"-\";\n        break;\n      case 2 /*k = NIFTI_P2A*/:\n        kChar = \"Y\";\n        kSense = \"+\";\n        break;\n      case -2 /*k = NIFTI_A2P*/:\n        kChar = \"Y\";\n        kSense = \"-\";\n        break;\n      case 3 /*k = NIFTI_I2S*/:\n        kChar = \"Z\";\n        kSense = \"+\";\n        break;\n      case -3 /*k = NIFTI_S2I*/:\n        kChar = \"Z\";\n        kSense = \"-\";\n        break;\n    }\n    return iChar + jChar + kChar + iSense + jSense + kSense;\n  }\n  /**\n   * Returns the byte index of the extension.\n   * @returns {number}\n   */\n  getExtensionLocation() {\n    return NIFTI1.MAGIC_COOKIE + 4;\n  }\n  /**\n   * Returns the extension size.\n   * @param {DataView} data\n   * @returns {number}\n   */\n  getExtensionSize(data) {\n    return utilities_1.Utils.getIntAt(data, this.getExtensionLocation(), this.littleEndian);\n  }\n  /**\n   * Returns the extension code.\n   * @param {DataView} data\n   * @returns {number}\n   */\n  getExtensionCode(data) {\n    return utilities_1.Utils.getIntAt(data, this.getExtensionLocation() + 4, this.littleEndian);\n  }\n  /**\n   * Adds an extension\n   * @param {NIFTIEXTENSION} extension\n   * @param {number} index\n   */\n  addExtension(extension) {\n    let index = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : -1;\n    if (index == -1) {\n      this.extensions.push(extension);\n    } else {\n      this.extensions.splice(index, 0, extension);\n    }\n    this.vox_offset += extension.esize;\n  }\n  /**\n   * Removes an extension\n   * @param {number} index\n   */\n  removeExtension(index) {\n    let extension = this.extensions[index];\n    if (extension) {\n      this.vox_offset -= extension.esize;\n    }\n    this.extensions.splice(index, 1);\n  }\n  /**\n   * Returns header as ArrayBuffer.\n   * @param {boolean} includeExtensions - should extension bytes be included\n   * @returns {ArrayBuffer}\n   */\n  toArrayBuffer() {\n    let includeExtensions = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    const SHORT_SIZE = 2;\n    const FLOAT32_SIZE = 4;\n    let byteSize = 348 + 4; // + 4 for the extension bytes\n    // calculate necessary size\n    if (includeExtensions) {\n      for (let extension of this.extensions) {\n        byteSize += extension.esize;\n      }\n    }\n    let byteArray = new Uint8Array(byteSize);\n    let view = new DataView(byteArray.buffer);\n    // sizeof_hdr\n    view.setInt32(0, 348, this.littleEndian);\n    // data_type, db_name, extents, session_error, regular are not used\n    // dim_info\n    view.setUint8(39, this.dim_info);\n    // dims\n    for (let i = 0; i < 8; i++) {\n      view.setUint16(40 + SHORT_SIZE * i, this.dims[i], this.littleEndian);\n    }\n    // intent_p1, intent_p2, intent_p3\n    view.setFloat32(56, this.intent_p1, this.littleEndian);\n    view.setFloat32(60, this.intent_p2, this.littleEndian);\n    view.setFloat32(64, this.intent_p3, this.littleEndian);\n    // intent_code, datatype, bitpix, slice_start\n    view.setInt16(68, this.intent_code, this.littleEndian);\n    view.setInt16(70, this.datatypeCode, this.littleEndian);\n    view.setInt16(72, this.numBitsPerVoxel, this.littleEndian);\n    view.setInt16(74, this.slice_start, this.littleEndian);\n    // pixdim[8], vox_offset, scl_slope, scl_inter\n    for (let i = 0; i < 8; i++) {\n      view.setFloat32(76 + FLOAT32_SIZE * i, this.pixDims[i], this.littleEndian);\n    }\n    view.setFloat32(108, this.vox_offset, this.littleEndian);\n    view.setFloat32(112, this.scl_slope, this.littleEndian);\n    view.setFloat32(116, this.scl_inter, this.littleEndian);\n    // slice_end\n    view.setInt16(120, this.slice_end, this.littleEndian);\n    // slice_code, xyzt_units\n    view.setUint8(122, this.slice_code);\n    view.setUint8(123, this.xyzt_units);\n    // cal_max, cal_min, slice_duration, toffset\n    view.setFloat32(124, this.cal_max, this.littleEndian);\n    view.setFloat32(128, this.cal_min, this.littleEndian);\n    view.setFloat32(132, this.slice_duration, this.littleEndian);\n    view.setFloat32(136, this.toffset, this.littleEndian);\n    // glmax, glmin are unused\n    // descrip and aux_file\n    byteArray.set(Buffer.from(this.description), 148);\n    byteArray.set(Buffer.from(this.aux_file), 228);\n    // qform_code, sform_code\n    view.setInt16(252, this.qform_code, this.littleEndian);\n    view.setInt16(254, this.sform_code, this.littleEndian);\n    // quatern_b, quatern_c, quatern_d, qoffset_x, qoffset_y, qoffset_z, srow_x[4], srow_y[4], and srow_z[4]\n    view.setFloat32(256, this.quatern_b, this.littleEndian);\n    view.setFloat32(260, this.quatern_c, this.littleEndian);\n    view.setFloat32(264, this.quatern_d, this.littleEndian);\n    view.setFloat32(268, this.qoffset_x, this.littleEndian);\n    view.setFloat32(272, this.qoffset_y, this.littleEndian);\n    view.setFloat32(276, this.qoffset_z, this.littleEndian);\n    const flattened = this.affine.flat();\n    // we only want the first three rows\n    for (let i = 0; i < 12; i++) {\n      view.setFloat32(280 + FLOAT32_SIZE * i, flattened[i], this.littleEndian);\n    }\n    // intent_name and magic\n    byteArray.set(Buffer.from(this.intent_name), 328);\n    byteArray.set(Buffer.from(this.magic), 344);\n    // add our extension data\n    if (includeExtensions) {\n      byteArray.set(Uint8Array.from([1, 0, 0, 0]), 348);\n      let extensionByteIndex = this.getExtensionLocation();\n      for (const extension of this.extensions) {\n        view.setInt32(extensionByteIndex, extension.esize, extension.littleEndian);\n        view.setInt32(extensionByteIndex + 4, extension.ecode, extension.littleEndian);\n        byteArray.set(new Uint8Array(extension.edata), extensionByteIndex + 8);\n        extensionByteIndex += extension.esize;\n      }\n    } else {\n      // In a .nii file, these 4 bytes will always be present\n      byteArray.set(new Uint8Array(4).fill(0), 348);\n    }\n    return byteArray.buffer;\n  }\n}\n/*** Static Pseudo-constants ***/\n// datatype codes\n_defineProperty(NIFTI1, \"TYPE_NONE\", 0);\n_defineProperty(NIFTI1, \"TYPE_BINARY\", 1);\n_defineProperty(NIFTI1, \"TYPE_UINT8\", 2);\n_defineProperty(NIFTI1, \"TYPE_INT16\", 4);\n_defineProperty(NIFTI1, \"TYPE_INT32\", 8);\n_defineProperty(NIFTI1, \"TYPE_FLOAT32\", 16);\n_defineProperty(NIFTI1, \"TYPE_COMPLEX64\", 32);\n_defineProperty(NIFTI1, \"TYPE_FLOAT64\", 64);\n_defineProperty(NIFTI1, \"TYPE_RGB24\", 128);\n_defineProperty(NIFTI1, \"TYPE_INT8\", 256);\n_defineProperty(NIFTI1, \"TYPE_UINT16\", 512);\n_defineProperty(NIFTI1, \"TYPE_UINT32\", 768);\n_defineProperty(NIFTI1, \"TYPE_INT64\", 1024);\n_defineProperty(NIFTI1, \"TYPE_UINT64\", 1280);\n_defineProperty(NIFTI1, \"TYPE_FLOAT128\", 1536);\n_defineProperty(NIFTI1, \"TYPE_COMPLEX128\", 1792);\n_defineProperty(NIFTI1, \"TYPE_COMPLEX256\", 2048);\n// transform codes\n_defineProperty(NIFTI1, \"XFORM_UNKNOWN\", 0);\n_defineProperty(NIFTI1, \"XFORM_SCANNER_ANAT\", 1);\n_defineProperty(NIFTI1, \"XFORM_ALIGNED_ANAT\", 2);\n_defineProperty(NIFTI1, \"XFORM_TALAIRACH\", 3);\n_defineProperty(NIFTI1, \"XFORM_MNI_152\", 4);\n// unit codes\n_defineProperty(NIFTI1, \"SPATIAL_UNITS_MASK\", 0x07);\n_defineProperty(NIFTI1, \"TEMPORAL_UNITS_MASK\", 0x38);\n_defineProperty(NIFTI1, \"UNITS_UNKNOWN\", 0);\n_defineProperty(NIFTI1, \"UNITS_METER\", 1);\n_defineProperty(NIFTI1, \"UNITS_MM\", 2);\n_defineProperty(NIFTI1, \"UNITS_MICRON\", 3);\n_defineProperty(NIFTI1, \"UNITS_SEC\", 8);\n_defineProperty(NIFTI1, \"UNITS_MSEC\", 16);\n_defineProperty(NIFTI1, \"UNITS_USEC\", 24);\n_defineProperty(NIFTI1, \"UNITS_HZ\", 32);\n_defineProperty(NIFTI1, \"UNITS_PPM\", 40);\n_defineProperty(NIFTI1, \"UNITS_RADS\", 48);\n// nifti1 codes\n_defineProperty(NIFTI1, \"MAGIC_COOKIE\", 348);\n_defineProperty(NIFTI1, \"STANDARD_HEADER_SIZE\", 348);\n_defineProperty(NIFTI1, \"MAGIC_NUMBER_LOCATION\", 344);\n_defineProperty(NIFTI1, \"MAGIC_NUMBER\", [0x6e, 0x2b, 0x31]);\n// n+1 (.nii)\n_defineProperty(NIFTI1, \"MAGIC_NUMBER2\", [0x6e, 0x69, 0x31]);\n// ni1 (.hdr/.img)\n_defineProperty(NIFTI1, \"EXTENSION_HEADER_SIZE\", 8);\nexports.NIFTI1 = NIFTI1;","map":{"version":3,"names":["utilities_1","require","NIFTI1","constructor","_defineProperty","code","TYPE_UINT8","TYPE_INT16","TYPE_INT32","TYPE_FLOAT32","TYPE_FLOAT64","TYPE_RGB24","TYPE_INT8","TYPE_UINT16","TYPE_UINT32","TYPE_INT64","TYPE_UINT64","XFORM_SCANNER_ANAT","XFORM_ALIGNED_ANAT","XFORM_TALAIRACH","XFORM_MNI_152","UNITS_METER","UNITS_MM","UNITS_MICRON","UNITS_SEC","UNITS_MSEC","UNITS_USEC","UNITS_HZ","UNITS_PPM","UNITS_RADS","A","B","C","i","j","R","r11","r12","r13","r21","r22","r23","r31","r32","r33","readHeader","data","rawData","DataView","magicCookieVal","Utils","getIntAt","littleEndian","ctr","ctrOut","ctrIn","index","MAGIC_COOKIE","Error","dim_info","getByteAt","dims","getShortAt","intent_p1","getFloatAt","intent_p2","intent_p3","intent_code","datatypeCode","numBitsPerVoxel","slice_start","pixDims","vox_offset","scl_slope","scl_inter","slice_end","slice_code","xyzt_units","cal_max","cal_min","slice_duration","toffset","description","getStringAt","aux_file","qform_code","sform_code","quatern_b","quatern_c","quatern_d","quatern_a","Math","sqrt","pow","qoffset_x","qoffset_y","qoffset_z","affine","a","b","c","d","qfac","quatern_R","intent_name","magic","isHDR","String","fromCharCode","apply","MAGIC_NUMBER2","byteLength","extensionFlag","isExtensionCapable","extensions","getExtensionsAt","getExtensionLocation","extensionSize","esize","extensionCode","ecode","toFormattedString","fmt","formatNumber","string","getDatatypeCodeString","getUnitsCodeString","SPATIAL_UNITS_MASK","TEMPORAL_UNITS_MASK","getTransformCodeString","getQformMat","convertNiftiQFormToNiftiSForm","qb","qc","qd","qx","qy","qz","dx","dy","dz","xd","yd","zd","convertNiftiSFormToNEMA","xi","xj","xk","yi","yj","yk","zi","zj","zk","val","detQ","detP","k","p","q","r","ibest","jbest","kbest","pbest","qbest","rbest","M","vbest","Q","P","iChar","jChar","kChar","iSense","jSense","kSense","abs","nifti_mat33_determ","nifti_mat33_mul","getExtensionSize","getExtensionCode","addExtension","extension","arguments","length","undefined","push","splice","removeExtension","toArrayBuffer","includeExtensions","SHORT_SIZE","FLOAT32_SIZE","byteSize","byteArray","Uint8Array","view","buffer","setInt32","setUint8","setUint16","setFloat32","setInt16","set","Buffer","from","flattened","flat","extensionByteIndex","edata","fill","exports"],"sources":["/home/prabhashj07/synthetic_x-ray_generator/node_modules/nifti-reader-js/src/nifti1.ts"],"sourcesContent":["import { NIFTIEXTENSION } from \"./nifti-extension\";\nimport { Utils } from \"./utilities\";\n\n/*** Constructor ***/\n/**\n   * The NIFTI1 constructor.\n   * @constructor\n   * @property {boolean} littleEndian\n   * @property {number} dim_info\n   * @property {number[]} dims - image dimensions\n   * @property {number} intent_p1\n   * @property {number} intent_p2\n   * @property {number} intent_p3\n   * @property {number} intent_code\n   * @property {number} datatypeCode\n   * @property {number} numBitsPerVoxel\n   * @property {number} slice_start\n   * @property {number} slice_end\n   * @property {number} slice_code\n   * @property {number[]} pixDims - voxel dimensions\n   * @property {number} vox_offset\n   * @property {number} scl_slope\n   * @property {number} scl_inter\n   * @property {number} xyzt_units\n   * @property {number} cal_max\n   * @property {number} cal_min\n   * @property {number} slice_duration\n   * @property {number} toffset\n   * @property {string} description\n   * @property {string} aux_file\n   * @property {string} intent_name\n   * @property {number} qform_code\n   * @property {number} sform_code\n   * @property {number} quatern_b\n   * @property {number} quatern_c\n   * @property {number} quatern_d\n   * @property {number} quatern_x\n   * @property {number} quatern_y\n   * @property {number} quatern_z\n   * @property {Array.<Array.<number>>} affine\n   * @property {string} magic\n   * @property {boolean} isHDR - if hdr/img format\n   * @property {number[]} extensionFlag\n   * @property {number} extensionSize\n   * @property {number} extensionCode\n   * @property {nifti.NIFTIEXTENSION[]} extensions\n   * @type {Function}\n   */\n  export class NIFTI1 {\n    littleEndian = false;\n    dim_info = 0;\n    dims: number[] = [];\n    intent_p1 = 0.0;\n    intent_p2 = 0.0;\n    intent_p3 = 0.0;\n    intent_code = 0;\n    datatypeCode = 0;\n    numBitsPerVoxel = 0;\n    slice_start = 0;\n    slice_end = 0;\n    slice_code = 0;\n    pixDims: number[] = [];\n    vox_offset = 0;\n    scl_slope = 1.0;\n    scl_inter = 0.0;\n    xyzt_units = 0;\n    cal_max = 0.0;\n    cal_min = 0.0;\n    slice_duration = 0.0;\n    toffset = 0.0;\n    description = \"\";\n    aux_file = \"\";\n    intent_name = \"\";\n    qform_code = 0;\n    sform_code = 0;\n    quatern_a = 0.0;\n    quatern_b = 0.0;\n    quatern_c = 0.0;\n    quatern_d = 0.0;\n    qoffset_x = 0.0;\n    qoffset_y = 0.0;\n    qoffset_z = 0.0;\n    affine = [\n      [1, 0, 0, 0],\n      [0, 1, 0, 0],\n      [0, 0, 1, 0],\n      [0, 0, 0, 1],\n    ];\n    qfac = 1;\n    quatern_R: number[][] | undefined;\n    magic = \"0\";\n    isHDR = false;\n    extensionFlag = [0, 0, 0, 0];\n    extensionSize = 0;\n    extensionCode = 0;\n    extensions: NIFTIEXTENSION[] = [];\n\n    /*** Static Pseudo-constants ***/\n\n    // datatype codes\n    public static readonly TYPE_NONE = 0;\n    public static readonly TYPE_BINARY = 1;\n    public static readonly TYPE_UINT8 = 2;\n    public static readonly TYPE_INT16 = 4;\n    public static readonly TYPE_INT32 = 8;\n    public static readonly TYPE_FLOAT32 = 16;\n    public static readonly TYPE_COMPLEX64 = 32;\n    public static readonly TYPE_FLOAT64 = 64;\n    public static readonly TYPE_RGB24 = 128;\n    public static readonly TYPE_INT8 = 256;\n    public static readonly TYPE_UINT16 = 512;\n    public static readonly TYPE_UINT32 = 768;\n    public static readonly TYPE_INT64 = 1024;\n    public static readonly TYPE_UINT64 = 1280;\n    public static readonly TYPE_FLOAT128 = 1536;\n    public static readonly TYPE_COMPLEX128 = 1792;\n    public static readonly TYPE_COMPLEX256 = 2048;\n\n    // transform codes\n    public static readonly XFORM_UNKNOWN = 0;\n    public static readonly XFORM_SCANNER_ANAT = 1;\n    public static readonly XFORM_ALIGNED_ANAT = 2;\n    public static readonly XFORM_TALAIRACH = 3;\n    public static readonly XFORM_MNI_152 = 4;\n\n    // unit codes\n    public static readonly SPATIAL_UNITS_MASK = 0x07;\n    public static readonly TEMPORAL_UNITS_MASK = 0x38;\n    public static readonly UNITS_UNKNOWN = 0;\n    public static readonly UNITS_METER = 1;\n    public static readonly UNITS_MM = 2;\n    public static readonly UNITS_MICRON = 3;\n    public static readonly UNITS_SEC = 8;\n    public static readonly UNITS_MSEC = 16;\n    public static readonly UNITS_USEC = 24;\n    public static readonly UNITS_HZ = 32;\n    public static readonly UNITS_PPM = 40;\n    public static readonly UNITS_RADS = 48;\n\n    // nifti1 codes\n    public static readonly MAGIC_COOKIE = 348;\n    public static readonly STANDARD_HEADER_SIZE = 348;\n    public static readonly MAGIC_NUMBER_LOCATION = 344;\n    public static readonly MAGIC_NUMBER = [0x6e, 0x2b, 0x31]; // n+1 (.nii)\n    public static readonly MAGIC_NUMBER2 = [0x6e, 0x69, 0x31]; // ni1 (.hdr/.img)\n    public static readonly EXTENSION_HEADER_SIZE = 8;\n\n    /*** Prototype Methods ***/\n\n    /**\n     * Reads the header data.\n     * @param {ArrayBuffer} data\n     */\n    readHeader(data: ArrayBuffer) {\n      var rawData = new DataView(data),\n        magicCookieVal = Utils.getIntAt(rawData, 0, this.littleEndian),\n        ctr,\n        ctrOut,\n        ctrIn,\n        index;\n\n      if (magicCookieVal !== NIFTI1.MAGIC_COOKIE) {\n        // try as little endian\n        this.littleEndian = true;\n        magicCookieVal = Utils.getIntAt(rawData, 0, this.littleEndian);\n      }\n\n      if (magicCookieVal !== NIFTI1.MAGIC_COOKIE) {\n        throw new Error(\"This does not appear to be a NIFTI file!\");\n      }\n\n      this.dim_info = Utils.getByteAt(rawData, 39);\n\n      for (ctr = 0; ctr < 8; ctr += 1) {\n        index = 40 + ctr * 2;\n        this.dims[ctr] = Utils.getShortAt(\n          rawData,\n          index,\n          this.littleEndian\n        );\n      }\n\n      this.intent_p1 = Utils.getFloatAt(rawData, 56, this.littleEndian);\n      this.intent_p2 = Utils.getFloatAt(rawData, 60, this.littleEndian);\n      this.intent_p3 = Utils.getFloatAt(rawData, 64, this.littleEndian);\n      this.intent_code = Utils.getShortAt(rawData, 68, this.littleEndian);\n\n      this.datatypeCode = Utils.getShortAt(\n        rawData,\n        70,\n        this.littleEndian\n      );\n      this.numBitsPerVoxel = Utils.getShortAt(\n        rawData,\n        72,\n        this.littleEndian\n      );\n\n      this.slice_start = Utils.getShortAt(rawData, 74, this.littleEndian);\n\n      for (ctr = 0; ctr < 8; ctr += 1) {\n        index = 76 + ctr * 4;\n        this.pixDims[ctr] = Utils.getFloatAt(\n          rawData,\n          index,\n          this.littleEndian\n        );\n      }\n\n      this.vox_offset = Utils.getFloatAt(rawData, 108, this.littleEndian);\n\n      this.scl_slope = Utils.getFloatAt(rawData, 112, this.littleEndian);\n      this.scl_inter = Utils.getFloatAt(rawData, 116, this.littleEndian);\n\n      this.slice_end = Utils.getShortAt(rawData, 120, this.littleEndian);\n      this.slice_code = Utils.getByteAt(rawData, 122);\n\n      this.xyzt_units = Utils.getByteAt(rawData, 123);\n\n      this.cal_max = Utils.getFloatAt(rawData, 124, this.littleEndian);\n      this.cal_min = Utils.getFloatAt(rawData, 128, this.littleEndian);\n\n      this.slice_duration = Utils.getFloatAt(\n        rawData,\n        132,\n        this.littleEndian\n      );\n      this.toffset = Utils.getFloatAt(rawData, 136, this.littleEndian);\n\n      this.description = Utils.getStringAt(rawData, 148, 228);\n      this.aux_file = Utils.getStringAt(rawData, 228, 252);\n\n      this.qform_code = Utils.getShortAt(rawData, 252, this.littleEndian);\n      this.sform_code = Utils.getShortAt(rawData, 254, this.littleEndian);\n\n      this.quatern_b = Utils.getFloatAt(rawData, 256, this.littleEndian);\n      this.quatern_c = Utils.getFloatAt(rawData, 260, this.littleEndian);\n      this.quatern_d = Utils.getFloatAt(rawData, 264, this.littleEndian);\n      // Added by znshje on 27/11/2021\n      //\n      // quatern_a is a parameter in quaternion [a, b, c, d], which is required in affine calculation (METHOD 2)\n      // mentioned in the nifti1.h file\n      // It can be calculated by a = sqrt(1.0-(b*b+c*c+d*d))\n      this.quatern_a = Math.sqrt(\n        1.0 -\n          (Math.pow(this.quatern_b, 2) +\n            Math.pow(this.quatern_c, 2) +\n            Math.pow(this.quatern_d, 2))\n      );\n\n      this.qoffset_x = Utils.getFloatAt(rawData, 268, this.littleEndian);\n      this.qoffset_y = Utils.getFloatAt(rawData, 272, this.littleEndian);\n      this.qoffset_z = Utils.getFloatAt(rawData, 276, this.littleEndian);\n\n      // Added by znshje on 27/11/2021\n      //\n      /* See: https://nifti.nimh.nih.gov/pub/dist/src/niftilib/nifti1.h */\n      if ((this.qform_code < 1) && (this.sform_code < 1)) {\n        // METHOD 0 (used when both SFORM and QFORM are unknown)\n        this.affine[0][0] = this.pixDims[1];\n        this.affine[1][1] = this.pixDims[2];\n        this.affine[2][2] = this.pixDims[3];\n      }\n      if ((this.qform_code > 0) && (this.sform_code < this.qform_code)) {\n        //   METHOD 2 (used when qform_code > 0, which should be the \"normal\" case):\n        //    ---------------------------------------------------------------------\n        //    The (x,y,z) coordinates are given by the pixdim[] scales, a rotation\n        //    matrix, and a shift.  This method is intended to represent\n        //    \"scanner-anatomical\" coordinates, which are often embedded in the\n        //    image header (e.g., DICOM fields (0020,0032), (0020,0037), (0028,0030),\n        //    and (0018,0050)), and represent the nominal orientation and location of\n        //    the data.  This method can also be used to represent \"aligned\"\n        //    coordinates, which would typically result from some post-acquisition\n        //    alignment of the volume to a standard orientation (e.g., the same\n        //    subject on another day, or a rigid rotation to true anatomical\n        //    orientation from the tilted position of the subject in the scanner).\n        //    The formula for (x,y,z) in terms of header parameters and (i,j,k) is:\n        //\n        //      [ x ]   [ R11 R12 R13 ] [        pixdim[1] * i ]   [ qoffset_x ]\n        //      [ y ] = [ R21 R22 R23 ] [        pixdim[2] * j ] + [ qoffset_y ]\n        //      [ z ]   [ R31 R32 R33 ] [ qfac * pixdim[3] * k ]   [ qoffset_z ]\n        //\n        //    The qoffset_* shifts are in the NIFTI-1 header.  Note that the center\n        //    of the (i,j,k)=(0,0,0) voxel (first value in the dataset array) is\n        //    just (x,y,z)=(qoffset_x,qoffset_y,qoffset_z).\n        //\n        //    The rotation matrix R is calculated from the quatern_* parameters.\n        //    This calculation is described below.\n        //\n        //    The scaling factor qfac is either 1 or -1.  The rotation matrix R\n        //    defined by the quaternion parameters is \"proper\" (has determinant 1).\n        //    This may not fit the needs of the data; for example, if the image\n        //    grid is\n        //      i increases from Left-to-Right\n        //      j increases from Anterior-to-Posterior\n        //      k increases from Inferior-to-Superior\n        //    Then (i,j,k) is a left-handed triple.  In this example, if qfac=1,\n        //    the R matrix would have to be\n        //\n        //      [  1   0   0 ]\n        //      [  0  -1   0 ]  which is \"improper\" (determinant = -1).\n        //      [  0   0   1 ]\n        //\n        //    If we set qfac=-1, then the R matrix would be\n        //\n        //      [  1   0   0 ]\n        //      [  0  -1   0 ]  which is proper.\n        //      [  0   0  -1 ]\n        //\n        //    This R matrix is represented by quaternion [a,b,c,d] = [0,1,0,0]\n        //    (which encodes a 180 degree rotation about the x-axis).\n\n        // Define a, b, c, d for coding covenience\n        const a = this.quatern_a;\n        const b = this.quatern_b;\n        const c = this.quatern_c;\n        const d = this.quatern_d;\n\n        this.qfac = this.pixDims[0] === 0 ? 1 : this.pixDims[0];\n\n        this.quatern_R = [\n          [\n            a * a + b * b - c * c - d * d,\n            2 * b * c - 2 * a * d,\n            2 * b * d + 2 * a * c,\n          ],\n          [\n            2 * b * c + 2 * a * d,\n            a * a + c * c - b * b - d * d,\n            2 * c * d - 2 * a * b,\n          ],\n          [\n            2 * b * d - 2 * a * c,\n            2 * c * d + 2 * a * b,\n            a * a + d * d - c * c - b * b,\n          ],\n        ];\n\n        for (ctrOut = 0; ctrOut < 3; ctrOut += 1) {\n          for (ctrIn = 0; ctrIn < 3; ctrIn += 1) {\n            this.affine[ctrOut][ctrIn] =\n              this.quatern_R[ctrOut][ctrIn] * this.pixDims[ctrIn + 1];\n            if (ctrIn === 2) {\n              this.affine[ctrOut][ctrIn] *= this.qfac;\n            }\n          }\n        }\n        // The last row of affine matrix is the offset vector\n        this.affine[0][3] = this.qoffset_x;\n        this.affine[1][3] = this.qoffset_y;\n        this.affine[2][3] = this.qoffset_z;\n      } else if (this.sform_code > 0) {\n        //    METHOD 3 (used when sform_code > 0):\n        //    -----------------------------------\n        //    The (x,y,z) coordinates are given by a general affine transformation\n        //    of the (i,j,k) indexes:\n        //\n        //      x = srow_x[0] * i + srow_x[1] * j + srow_x[2] * k + srow_x[3]\n        //      y = srow_y[0] * i + srow_y[1] * j + srow_y[2] * k + srow_y[3]\n        //      z = srow_z[0] * i + srow_z[1] * j + srow_z[2] * k + srow_z[3]\n        //\n        //    The srow_* vectors are in the NIFTI_1 header.  Note that no use is\n        //    made of pixdim[] in this method.\n        for (ctrOut = 0; ctrOut < 3; ctrOut += 1) {\n          for (ctrIn = 0; ctrIn < 4; ctrIn += 1) {\n            index = 280 + (ctrOut * 4 + ctrIn) * 4;\n            this.affine[ctrOut][ctrIn] = Utils.getFloatAt(\n              rawData,\n              index,\n              this.littleEndian\n            );\n          }\n        }\n      }\n\n      this.affine[3][0] = 0;\n      this.affine[3][1] = 0;\n      this.affine[3][2] = 0;\n      this.affine[3][3] = 1;\n\n      this.intent_name = Utils.getStringAt(rawData, 328, 344);\n      this.magic = Utils.getStringAt(rawData, 344, 348);\n\n      this.isHDR = this.magic === String.fromCharCode.apply(null, NIFTI1.MAGIC_NUMBER2);\n\n      if (rawData.byteLength > NIFTI1.MAGIC_COOKIE) {\n        this.extensionFlag[0] = Utils.getByteAt(rawData, 348);\n        this.extensionFlag[1] = Utils.getByteAt(rawData, 348 + 1);\n        this.extensionFlag[2] = Utils.getByteAt(rawData, 348 + 2);\n        this.extensionFlag[3] = Utils.getByteAt(rawData, 348 + 3);\n\n        let isExtensionCapable = true;\n        if ((!this.isHDR) && (this.vox_offset <= 352))\n          isExtensionCapable = false;\n        if (rawData.byteLength <= (352 + 16))\n          isExtensionCapable = false;\n\n        if (isExtensionCapable && this.extensionFlag[0]) {\n          // read our extensions\n          this.extensions = Utils.getExtensionsAt(\n            rawData,\n            this.getExtensionLocation(),\n            this.littleEndian,\n            this.vox_offset\n          );\n\n          // set the extensionSize and extensionCode from the first extension found\n          this.extensionSize = this.extensions[0].esize;\n          this.extensionCode = this.extensions[0].ecode;\n        }\n      }\n    }\n\n    /**\n     * Returns a formatted string of header fields.\n     * @returns {string}\n     */\n    toFormattedString(): string {\n      var fmt = Utils.formatNumber,\n        string = \"\";\n\n      string += \"Dim Info = \" + this.dim_info + \"\\n\";\n\n      string +=\n        \"Image Dimensions (1-8): \" +\n        this.dims[0] +\n        \", \" +\n        this.dims[1] +\n        \", \" +\n        this.dims[2] +\n        \", \" +\n        this.dims[3] +\n        \", \" +\n        this.dims[4] +\n        \", \" +\n        this.dims[5] +\n        \", \" +\n        this.dims[6] +\n        \", \" +\n        this.dims[7] +\n        \"\\n\";\n\n      string +=\n        \"Intent Parameters (1-3): \" +\n        this.intent_p1 +\n        \", \" +\n        this.intent_p2 +\n        \", \" +\n        this.intent_p3 +\n        \"\\n\";\n\n      string += \"Intent Code = \" + this.intent_code + \"\\n\";\n      string +=\n        \"Datatype = \" +\n        this.datatypeCode +\n        \" (\" +\n        this.getDatatypeCodeString(this.datatypeCode) +\n        \")\\n\";\n      string += \"Bits Per Voxel = \" + this.numBitsPerVoxel + \"\\n\";\n      string += \"Slice Start = \" + this.slice_start + \"\\n\";\n      string +=\n        \"Voxel Dimensions (1-8): \" +\n        fmt(this.pixDims[0]) +\n        \", \" +\n        fmt(this.pixDims[1]) +\n        \", \" +\n        fmt(this.pixDims[2]) +\n        \", \" +\n        fmt(this.pixDims[3]) +\n        \", \" +\n        fmt(this.pixDims[4]) +\n        \", \" +\n        fmt(this.pixDims[5]) +\n        \", \" +\n        fmt(this.pixDims[6]) +\n        \", \" +\n        fmt(this.pixDims[7]) +\n        \"\\n\";\n\n      string += \"Image Offset = \" + this.vox_offset + \"\\n\";\n      string +=\n        \"Data Scale:  Slope = \" +\n        fmt(this.scl_slope) +\n        \"  Intercept = \" +\n        fmt(this.scl_inter) +\n        \"\\n\";\n      string += \"Slice End = \" + this.slice_end + \"\\n\";\n      string += \"Slice Code = \" + this.slice_code + \"\\n\";\n      string +=\n        \"Units Code = \" +\n        this.xyzt_units +\n        \" (\" +\n        this.getUnitsCodeString(\n          NIFTI1.SPATIAL_UNITS_MASK & this.xyzt_units\n        ) +\n        \", \" +\n        this.getUnitsCodeString(\n          NIFTI1.TEMPORAL_UNITS_MASK & this.xyzt_units\n        ) +\n        \")\\n\";\n      string +=\n        \"Display Range:  Max = \" +\n        fmt(this.cal_max) +\n        \"  Min = \" +\n        fmt(this.cal_min) +\n        \"\\n\";\n      string += \"Slice Duration = \" + this.slice_duration + \"\\n\";\n      string += \"Time Axis Shift = \" + this.toffset + \"\\n\";\n      string += 'Description: \"' + this.description + '\"\\n';\n      string += 'Auxiliary File: \"' + this.aux_file + '\"\\n';\n      string +=\n        \"Q-Form Code = \" +\n        this.qform_code +\n        \" (\" +\n        this.getTransformCodeString(this.qform_code) +\n        \")\\n\";\n      string +=\n        \"S-Form Code = \" +\n        this.sform_code +\n        \" (\" +\n        this.getTransformCodeString(this.sform_code) +\n        \")\\n\";\n      string +=\n        \"Quaternion Parameters:  \" +\n        \"b = \" +\n        fmt(this.quatern_b) +\n        \"  \" +\n        \"c = \" +\n        fmt(this.quatern_c) +\n        \"  \" +\n        \"d = \" +\n        fmt(this.quatern_d) +\n        \"\\n\";\n\n      string +=\n        \"Quaternion Offsets:  \" +\n        \"x = \" +\n        this.qoffset_x +\n        \"  \" +\n        \"y = \" +\n        this.qoffset_y +\n        \"  \" +\n        \"z = \" +\n        this.qoffset_z +\n        \"\\n\";\n\n      string +=\n        \"S-Form Parameters X: \" +\n        fmt(this.affine[0][0]) +\n        \", \" +\n        fmt(this.affine[0][1]) +\n        \", \" +\n        fmt(this.affine[0][2]) +\n        \", \" +\n        fmt(this.affine[0][3]) +\n        \"\\n\";\n\n      string +=\n        \"S-Form Parameters Y: \" +\n        fmt(this.affine[1][0]) +\n        \", \" +\n        fmt(this.affine[1][1]) +\n        \", \" +\n        fmt(this.affine[1][2]) +\n        \", \" +\n        fmt(this.affine[1][3]) +\n        \"\\n\";\n\n      string +=\n        \"S-Form Parameters Z: \" +\n        fmt(this.affine[2][0]) +\n        \", \" +\n        fmt(this.affine[2][1]) +\n        \", \" +\n        fmt(this.affine[2][2]) +\n        \", \" +\n        fmt(this.affine[2][3]) +\n        \"\\n\";\n\n      string += 'Intent Name: \"' + this.intent_name + '\"\\n';\n\n      if (this.extensionFlag[0]) {\n        string +=\n          \"Extension: Size = \" +\n          this.extensionSize +\n          \"  Code = \" +\n          this.extensionCode +\n          \"\\n\";\n      }\n\n      return string;\n    }\n\n    /**\n     * Returns a human-readable string of datatype.\n     * @param {number} code\n     * @returns {string}\n     */\n    getDatatypeCodeString = function (code: number): string {\n      if (code === NIFTI1.TYPE_UINT8) {\n        return \"1-Byte Unsigned Integer\";\n      } else if (code === NIFTI1.TYPE_INT16) {\n        return \"2-Byte Signed Integer\";\n      } else if (code === NIFTI1.TYPE_INT32) {\n        return \"4-Byte Signed Integer\";\n      } else if (code === NIFTI1.TYPE_FLOAT32) {\n        return \"4-Byte Float\";\n      } else if (code === NIFTI1.TYPE_FLOAT64) {\n        return \"8-Byte Float\";\n      } else if (code === NIFTI1.TYPE_RGB24) {\n        return \"RGB\";\n      } else if (code === NIFTI1.TYPE_INT8) {\n        return \"1-Byte Signed Integer\";\n      } else if (code === NIFTI1.TYPE_UINT16) {\n        return \"2-Byte Unsigned Integer\";\n      } else if (code === NIFTI1.TYPE_UINT32) {\n        return \"4-Byte Unsigned Integer\";\n      } else if (code === NIFTI1.TYPE_INT64) {\n        return \"8-Byte Signed Integer\";\n      } else if (code === NIFTI1.TYPE_UINT64) {\n        return \"8-Byte Unsigned Integer\";\n      } else {\n        return \"Unknown\";\n      }\n    };\n\n    /**\n     * Returns a human-readable string of transform type.\n     * @param {number} code\n     * @returns {string}\n     */\n    getTransformCodeString = function (code: number): string {\n      if (code === NIFTI1.XFORM_SCANNER_ANAT) {\n        return \"Scanner\";\n      } else if (code === NIFTI1.XFORM_ALIGNED_ANAT) {\n        return \"Aligned\";\n      } else if (code === NIFTI1.XFORM_TALAIRACH) {\n        return \"Talairach\";\n      } else if (code === NIFTI1.XFORM_MNI_152) {\n        return \"MNI\";\n      } else {\n        return \"Unknown\";\n      }\n    };\n\n    /**\n     * Returns a human-readable string of spatial and temporal units.\n     * @param {number} code\n     * @returns {string}\n     */\n    getUnitsCodeString = function (code: number): string {\n      if (code === NIFTI1.UNITS_METER) {\n        return \"Meters\";\n      } else if (code === NIFTI1.UNITS_MM) {\n        return \"Millimeters\";\n      } else if (code === NIFTI1.UNITS_MICRON) {\n        return \"Microns\";\n      } else if (code === NIFTI1.UNITS_SEC) {\n        return \"Seconds\";\n      } else if (code === NIFTI1.UNITS_MSEC) {\n        return \"Milliseconds\";\n      } else if (code === NIFTI1.UNITS_USEC) {\n        return \"Microseconds\";\n      } else if (code === NIFTI1.UNITS_HZ) {\n        return \"Hz\";\n      } else if (code === NIFTI1.UNITS_PPM) {\n        return \"PPM\";\n      } else if (code === NIFTI1.UNITS_RADS) {\n        return \"Rads\";\n      } else {\n        return \"Unknown\";\n      }\n    };\n\n    /**\n     * Returns the qform matrix.\n     * @returns {Array.<Array.<number>>}\n     */\n    getQformMat(): Array<Array<number>> {\n      return this.convertNiftiQFormToNiftiSForm(\n        this.quatern_b,\n        this.quatern_c,\n        this.quatern_d,\n        this.qoffset_x,\n        this.qoffset_y,\n        this.qoffset_z,\n        this.pixDims[1],\n        this.pixDims[2],\n        this.pixDims[3],\n        this.pixDims[0]\n      );\n    }\n\n    /**\n     * Converts qform to an affine.  (See http://nifti.nimh.nih.gov/pub/dist/src/niftilib/nifti1_io.c)\n     * @param {number} qb\n     * @param {number} qc\n     * @param {number} qd\n     * @param {number} qx\n     * @param {number} qy\n     * @param {number} qz\n     * @param {number} dx\n     * @param {number} dy\n     * @param {number} dz\n     * @param {number} qfac\n     * @returns {Array.<Array.<number>>}\n     */\n    convertNiftiQFormToNiftiSForm(\n      qb: number,\n      qc: number,\n      qd: number,\n      qx: number,\n      qy: number,\n      qz: number,\n      dx: number,\n      dy: number,\n      dz: number,\n      qfac: number\n    ): Array<Array<number>> {\n      var R = [\n          [0, 0, 0, 0],\n          [0, 0, 0, 0],\n          [0, 0, 0, 0],\n          [0, 0, 0, 0],\n        ],\n        a,\n        b = qb,\n        c = qc,\n        d = qd,\n        xd,\n        yd,\n        zd;\n\n      // last row is always [ 0 0 0 1 ]\n      R[3][0] = R[3][1] = R[3][2] = 0.0;\n      R[3][3] = 1.0;\n\n      // compute a parameter from b,c,d\n      a = 1.0 - (b * b + c * c + d * d);\n      if (a < 0.0000001) {\n        /* special case */\n\n        a = 1.0 / Math.sqrt(b * b + c * c + d * d);\n        b *= a;\n        c *= a;\n        d *= a; /* normalize (b,c,d) vector */\n        a = 0.0; /* a = 0 ==> 180 degree rotation */\n      } else {\n        a = Math.sqrt(a); /* angle = 2*arccos(a) */\n      }\n\n      // load rotation matrix, including scaling factors for voxel sizes\n      xd = dx > 0.0 ? dx : 1.0; /* make sure are positive */\n      yd = dy > 0.0 ? dy : 1.0;\n      zd = dz > 0.0 ? dz : 1.0;\n\n      if (qfac < 0.0) {\n        zd = -zd; /* left handedness? */\n      }\n\n      R[0][0] = (a * a + b * b - c * c - d * d) * xd;\n      R[0][1] = 2.0 * (b * c - a * d) * yd;\n      R[0][2] = 2.0 * (b * d + a * c) * zd;\n      R[1][0] = 2.0 * (b * c + a * d) * xd;\n      R[1][1] = (a * a + c * c - b * b - d * d) * yd;\n      R[1][2] = 2.0 * (c * d - a * b) * zd;\n      R[2][0] = 2.0 * (b * d - a * c) * xd;\n      R[2][1] = 2.0 * (c * d + a * b) * yd;\n      R[2][2] = (a * a + d * d - c * c - b * b) * zd;\n\n      // load offsets\n      R[0][3] = qx;\n      R[1][3] = qy;\n      R[2][3] = qz;\n\n      return R;\n    }\n\n    /**\n     * Converts sform to an orientation string (e.g., XYZ+--).  (See http://nifti.nimh.nih.gov/pub/dist/src/niftilib/nifti1_io.c)\n     * @param {Array.<Array.<number>>} R\n     * @returns {string}\n     */\n    convertNiftiSFormToNEMA(R: Array<Array<number>>): string | null {\n      var xi,\n        xj,\n        xk,\n        yi,\n        yj,\n        yk,\n        zi,\n        zj,\n        zk,\n        val,\n        detQ,\n        detP,\n        i,\n        j,\n        k,\n        p,\n        q,\n        r,\n        ibest,\n        jbest,\n        kbest,\n        pbest,\n        qbest,\n        rbest,\n        M,\n        vbest,\n        Q,\n        P,\n        iChar,\n        jChar,\n        kChar,\n        iSense,\n        jSense,\n        kSense;\n      k = 0;\n\n      Q = [\n        [0, 0, 0],\n        [0, 0, 0],\n        [0, 0, 0],\n      ];\n      P = [\n        [0, 0, 0],\n        [0, 0, 0],\n        [0, 0, 0],\n      ];\n\n      //if( icod == NULL || jcod == NULL || kcod == NULL ) return ; /* bad */\n\n      //*icod = *jcod = *kcod = 0 ; /* this.errorMessage returns, if sh*t happens */\n\n      /* load column vectors for each (i,j,k) direction from matrix */\n\n      /*-- i axis --*/ /*-- j axis --*/ /*-- k axis --*/\n\n      xi = R[0][0];\n      xj = R[0][1];\n      xk = R[0][2];\n\n      yi = R[1][0];\n      yj = R[1][1];\n      yk = R[1][2];\n\n      zi = R[2][0];\n      zj = R[2][1];\n      zk = R[2][2];\n\n      /* normalize column vectors to get unit vectors along each ijk-axis */\n\n      /* normalize i axis */\n      val = Math.sqrt(xi * xi + yi * yi + zi * zi);\n      if (val === 0.0) {\n        /* stupid input */\n        return null;\n      }\n\n      xi /= val;\n      yi /= val;\n      zi /= val;\n\n      /* normalize j axis */\n      val = Math.sqrt(xj * xj + yj * yj + zj * zj);\n      if (val === 0.0) {\n        /* stupid input */\n        return null;\n      }\n\n      xj /= val;\n      yj /= val;\n      zj /= val;\n\n      /* orthogonalize j axis to i axis, if needed */\n      val = xi * xj + yi * yj + zi * zj; /* dot product between i and j */\n      if (Math.abs(val) > 1e-4) {\n        xj -= val * xi;\n        yj -= val * yi;\n        zj -= val * zi;\n        val = Math.sqrt(xj * xj + yj * yj + zj * zj); /* must renormalize */\n        if (val === 0.0) {\n          /* j was parallel to i? */\n          return null;\n        }\n        xj /= val;\n        yj /= val;\n        zj /= val;\n      }\n\n      /* normalize k axis; if it is zero, make it the cross product i x j */\n      val = Math.sqrt(xk * xk + yk * yk + zk * zk);\n      if (val === 0.0) {\n        xk = yi * zj - zi * yj;\n        yk = zi * xj - zj * xi;\n        zk = xi * yj - yi * xj;\n      } else {\n        xk /= val;\n        yk /= val;\n        zk /= val;\n      }\n\n      /* orthogonalize k to i */\n      val = xi * xk + yi * yk + zi * zk; /* dot product between i and k */\n      if (Math.abs(val) > 1e-4) {\n        xk -= val * xi;\n        yk -= val * yi;\n        zk -= val * zi;\n        val = Math.sqrt(xk * xk + yk * yk + zk * zk);\n        if (val === 0.0) {\n          /* bad */\n          return null;\n        }\n        xk /= val;\n        yk /= val;\n        zk /= val;\n      }\n\n      /* orthogonalize k to j */\n      val = xj * xk + yj * yk + zj * zk; /* dot product between j and k */\n      if (Math.abs(val) > 1e-4) {\n        xk -= val * xj;\n        yk -= val * yj;\n        zk -= val * zj;\n        val = Math.sqrt(xk * xk + yk * yk + zk * zk);\n        if (val === 0.0) {\n          /* bad */\n          return null;\n        }\n        xk /= val;\n        yk /= val;\n        zk /= val;\n      }\n\n      Q[0][0] = xi;\n      Q[0][1] = xj;\n      Q[0][2] = xk;\n      Q[1][0] = yi;\n      Q[1][1] = yj;\n      Q[1][2] = yk;\n      Q[2][0] = zi;\n      Q[2][1] = zj;\n      Q[2][2] = zk;\n\n      /* at this point, Q is the rotation matrix from the (i,j,k) to (x,y,z) axes */\n\n      detQ = this.nifti_mat33_determ(Q);\n      if (detQ === 0.0) {\n        /* shouldn't happen unless user is a DUFIS */\n        return null;\n      }\n\n      /* Build and test all possible +1/-1 coordinate permutation matrices P;\n     then find the P such that the rotation matrix M=PQ is closest to the\n     identity, in the sense of M having the smallest total rotation angle. */\n\n      /* Despite the formidable looking 6 nested loops, there are\n     only 3*3*3*2*2*2 = 216 passes, which will run very quickly. */\n\n      vbest = -666.0;\n      ibest = pbest = qbest = rbest = 1;\n      jbest = 2;\n      kbest = 3;\n\n      for (i = 1; i <= 3; i += 1) {\n        /* i = column number to use for row #1 */\n        for (j = 1; j <= 3; j += 1) {\n          /* j = column number to use for row #2 */\n          if (i !== j) {\n            for (k = 1; k <= 3; k += 1) {\n              /* k = column number to use for row #3 */\n              if (!(i === k || j === k)) {\n                P[0][0] =\n                  P[0][1] =\n                  P[0][2] =\n                  P[1][0] =\n                  P[1][1] =\n                  P[1][2] =\n                  P[2][0] =\n                  P[2][1] =\n                  P[2][2] =\n                    0.0;\n                for (p = -1; p <= 1; p += 2) {\n                  /* p,q,r are -1 or +1      */\n                  for (q = -1; q <= 1; q += 2) {\n                    /* and go into rows #1,2,3 */\n                    for (r = -1; r <= 1; r += 2) {\n                      P[0][i - 1] = p;\n                      P[1][j - 1] = q;\n                      P[2][k - 1] = r;\n                      detP =\n                        this.nifti_mat33_determ(P); /* sign of permutation */\n                      if (detP * detQ > 0.0) {\n                        M = this.nifti_mat33_mul(P, Q);\n\n                        /* angle of M rotation = 2.0*acos(0.5*sqrt(1.0+trace(M)))       */\n                        /* we want largest trace(M) == smallest angle == M nearest to I */\n\n                        val = M[0][0] + M[1][1] + M[2][2]; /* trace */\n                        if (val > vbest) {\n                          vbest = val;\n                          ibest = i;\n                          jbest = j;\n                          kbest = k;\n                          pbest = p;\n                          qbest = q;\n                          rbest = r;\n                        }\n                      } /* doesn't match sign of Q */\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n\n      /* At this point ibest is 1 or 2 or 3; pbest is -1 or +1; etc.\n\n     The matrix P that corresponds is the best permutation approximation\n     to Q-inverse; that is, P (approximately) takes (x,y,z) coordinates\n     to the (i,j,k) axes.\n\n     For example, the first row of P (which contains pbest in column ibest)\n     determines the way the i axis points relative to the anatomical\n     (x,y,z) axes.  If ibest is 2, then the i axis is along the y axis,\n     which is direction P2A (if pbest > 0) or A2P (if pbest < 0).\n\n     So, using ibest and pbest, we can assign the output code for\n     the i axis.  Mutatis mutandis for the j and k axes, of course. */\n\n      iChar = jChar = kChar = iSense = jSense = kSense = \"\";\n\n      switch (ibest * pbest) {\n        case 1 /*i = NIFTI_L2R*/:\n          iChar = \"X\";\n          iSense = \"+\";\n          break;\n        case -1 /*i = NIFTI_R2L*/:\n          iChar = \"X\";\n          iSense = \"-\";\n          break;\n        case 2 /*i = NIFTI_P2A*/:\n          iChar = \"Y\";\n          iSense = \"+\";\n          break;\n        case -2 /*i = NIFTI_A2P*/:\n          iChar = \"Y\";\n          iSense = \"-\";\n          break;\n        case 3 /*i = NIFTI_I2S*/:\n          iChar = \"Z\";\n          iSense = \"+\";\n          break;\n        case -3 /*i = NIFTI_S2I*/:\n          iChar = \"Z\";\n          iSense = \"-\";\n          break;\n      }\n\n      switch (jbest * qbest) {\n        case 1 /*j = NIFTI_L2R*/:\n          jChar = \"X\";\n          jSense = \"+\";\n          break;\n        case -1 /*j = NIFTI_R2L*/:\n          jChar = \"X\";\n          jSense = \"-\";\n          break;\n        case 2 /*j = NIFTI_P2A*/:\n          jChar = \"Y\";\n          jSense = \"+\";\n          break;\n        case -2 /*j = NIFTI_A2P*/:\n          jChar = \"Y\";\n          jSense = \"-\";\n          break;\n        case 3 /*j = NIFTI_I2S*/:\n          jChar = \"Z\";\n          jSense = \"+\";\n          break;\n        case -3 /*j = NIFTI_S2I*/:\n          jChar = \"Z\";\n          jSense = \"-\";\n          break;\n      }\n\n      switch (kbest * rbest) {\n        case 1 /*k = NIFTI_L2R*/:\n          kChar = \"X\";\n          kSense = \"+\";\n          break;\n        case -1 /*k = NIFTI_R2L*/:\n          kChar = \"X\";\n          kSense = \"-\";\n          break;\n        case 2 /*k = NIFTI_P2A*/:\n          kChar = \"Y\";\n          kSense = \"+\";\n          break;\n        case -2 /*k = NIFTI_A2P*/:\n          kChar = \"Y\";\n          kSense = \"-\";\n          break;\n        case 3 /*k = NIFTI_I2S*/:\n          kChar = \"Z\";\n          kSense = \"+\";\n          break;\n        case -3 /*k = NIFTI_S2I*/:\n          kChar = \"Z\";\n          kSense = \"-\";\n          break;\n      }\n\n      return iChar + jChar + kChar + iSense + jSense + kSense;\n    }\n\n    nifti_mat33_mul = function (A: number[][], B: number[][]) {\n      var C = [\n          [0, 0, 0],\n          [0, 0, 0],\n          [0, 0, 0],\n        ],\n        i,\n        j;\n\n      for (i = 0; i < 3; i += 1) {\n        for (j = 0; j < 3; j += 1) {\n          C[i][j] = A[i][0] * B[0][j] + A[i][1] * B[1][j] + A[i][2] * B[2][j];\n        }\n      }\n\n      return C;\n    };\n\n    nifti_mat33_determ = function (R: number[][]) {\n      var r11, r12, r13, r21, r22, r23, r31, r32, r33;\n      /*  INPUT MATRIX:  */\n      r11 = R[0][0];\n      r12 = R[0][1];\n      r13 = R[0][2];\n      r21 = R[1][0];\n      r22 = R[1][1];\n      r23 = R[1][2];\n      r31 = R[2][0];\n      r32 = R[2][1];\n      r33 = R[2][2];\n\n      return (\n        r11 * r22 * r33 -\n        r11 * r32 * r23 -\n        r21 * r12 * r33 +\n        r21 * r32 * r13 +\n        r31 * r12 * r23 -\n        r31 * r22 * r13\n      );\n    };\n\n    /**\n     * Returns the byte index of the extension.\n     * @returns {number}\n     */\n    getExtensionLocation() {\n      return NIFTI1.MAGIC_COOKIE + 4;\n    }\n\n    /**\n     * Returns the extension size.\n     * @param {DataView} data\n     * @returns {number}\n     */\n    getExtensionSize(data: DataView) {\n      return Utils.getIntAt(\n        data,\n        this.getExtensionLocation(),\n        this.littleEndian\n      );\n    }\n\n    /**\n     * Returns the extension code.\n     * @param {DataView} data\n     * @returns {number}\n     */\n    getExtensionCode(data: DataView) {\n      return Utils.getIntAt(\n        data,\n        this.getExtensionLocation() + 4,\n        this.littleEndian\n      );\n    }\n\n    /**\n     * Adds an extension\n     * @param {NIFTIEXTENSION} extension\n     * @param {number} index\n     */\n    addExtension(extension: NIFTIEXTENSION, index = -1) {\n      if (index == -1) {\n        this.extensions.push(extension);\n      } else {\n        this.extensions.splice(index, 0, extension);\n      }\n      this.vox_offset += extension.esize;\n    }\n\n    /**\n     * Removes an extension\n     * @param {number} index\n     */\n    removeExtension(index: number) {\n      let extension = this.extensions[index];\n      if (extension) {\n        this.vox_offset -= extension.esize;\n      }\n      this.extensions.splice(index, 1);\n    }\n\n    /**\n     * Returns header as ArrayBuffer.\n     * @param {boolean} includeExtensions - should extension bytes be included\n     * @returns {ArrayBuffer}\n     */\n    toArrayBuffer(includeExtensions = false) {\n      const SHORT_SIZE = 2;\n      const FLOAT32_SIZE = 4;\n      let byteSize = 348 + 4; // + 4 for the extension bytes\n\n      // calculate necessary size\n      if (includeExtensions) {\n        for (let extension of this.extensions) {\n          byteSize += extension.esize;\n        }\n      }\n      let byteArray = new Uint8Array(byteSize);\n      let view = new DataView(byteArray.buffer);\n      // sizeof_hdr\n      view.setInt32(0, 348, this.littleEndian);\n\n      // data_type, db_name, extents, session_error, regular are not used\n\n      // dim_info\n      view.setUint8(39, this.dim_info);\n\n      // dims\n      for (let i = 0; i < 8; i++) {\n        view.setUint16(40 + SHORT_SIZE * i, this.dims[i], this.littleEndian);\n      }\n\n      // intent_p1, intent_p2, intent_p3\n      view.setFloat32(56, this.intent_p1, this.littleEndian);\n      view.setFloat32(60, this.intent_p2, this.littleEndian);\n      view.setFloat32(64, this.intent_p3, this.littleEndian);\n\n      // intent_code, datatype, bitpix, slice_start\n      view.setInt16(68, this.intent_code, this.littleEndian);\n      view.setInt16(70, this.datatypeCode, this.littleEndian);\n      view.setInt16(72, this.numBitsPerVoxel, this.littleEndian);\n      view.setInt16(74, this.slice_start, this.littleEndian);\n\n      // pixdim[8], vox_offset, scl_slope, scl_inter\n      for (let i = 0; i < 8; i++) {\n        view.setFloat32(\n          76 + FLOAT32_SIZE * i,\n          this.pixDims[i],\n          this.littleEndian\n        );\n      }\n      view.setFloat32(108, this.vox_offset, this.littleEndian);\n      view.setFloat32(112, this.scl_slope, this.littleEndian);\n      view.setFloat32(116, this.scl_inter, this.littleEndian);\n\n      // slice_end\n      view.setInt16(120, this.slice_end, this.littleEndian);\n\n      // slice_code, xyzt_units\n      view.setUint8(122, this.slice_code);\n      view.setUint8(123, this.xyzt_units);\n\n      // cal_max, cal_min, slice_duration, toffset\n      view.setFloat32(124, this.cal_max, this.littleEndian);\n      view.setFloat32(128, this.cal_min, this.littleEndian);\n      view.setFloat32(132, this.slice_duration, this.littleEndian);\n      view.setFloat32(136, this.toffset, this.littleEndian);\n\n      // glmax, glmin are unused\n\n      // descrip and aux_file\n      byteArray.set(Buffer.from(this.description), 148);\n      byteArray.set(Buffer.from(this.aux_file), 228);\n\n      // qform_code, sform_code\n      view.setInt16(252, this.qform_code, this.littleEndian);\n      view.setInt16(254, this.sform_code, this.littleEndian);\n\n      // quatern_b, quatern_c, quatern_d, qoffset_x, qoffset_y, qoffset_z, srow_x[4], srow_y[4], and srow_z[4]\n      view.setFloat32(256, this.quatern_b, this.littleEndian);\n      view.setFloat32(260, this.quatern_c, this.littleEndian);\n      view.setFloat32(264, this.quatern_d, this.littleEndian);\n      view.setFloat32(268, this.qoffset_x, this.littleEndian);\n      view.setFloat32(272, this.qoffset_y, this.littleEndian);\n      view.setFloat32(276, this.qoffset_z, this.littleEndian);\n      const flattened = this.affine.flat();\n      // we only want the first three rows\n      for (let i = 0; i < 12; i++) {\n        view.setFloat32(\n          280 + FLOAT32_SIZE * i,\n          flattened[i],\n          this.littleEndian\n        );\n      }\n\n      // intent_name and magic\n      byteArray.set(Buffer.from(this.intent_name), 328);\n      byteArray.set(Buffer.from(this.magic), 344);\n\n      // add our extension data\n      if (includeExtensions) {\n        byteArray.set(Uint8Array.from([1, 0, 0, 0]), 348);\n        let extensionByteIndex = this.getExtensionLocation();\n        for (const extension of this.extensions) {\n          view.setInt32(\n            extensionByteIndex,\n            extension.esize,\n            extension.littleEndian\n          );\n          view.setInt32(\n            extensionByteIndex + 4,\n            extension.ecode,\n            extension.littleEndian\n          );\n          byteArray.set(\n            new Uint8Array(extension.edata),\n            extensionByteIndex + 8\n          );\n          extensionByteIndex += extension.esize;\n        }\n      } else {\n        // In a .nii file, these 4 bytes will always be present\n        byteArray.set(new Uint8Array(4).fill(0), 348);\n      }\n\n      return byteArray.buffer;\n    }\n  }"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}